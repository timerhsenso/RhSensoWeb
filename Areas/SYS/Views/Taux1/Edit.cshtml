@model RhSensoWeb.Areas.SYS.Taux1.DTOs.Taux1Dto

<form id="formEdit" method="post" action="@Url.Action("Edit","Taux1", new { area="SYS", id = Model.Cdtptabela })">
  @Html.AntiForgeryToken()

  <div class="row g-3">
    <div class="col-md-3">
      <label class="form-label">CÃ³digo</label>
      <input class="form-control" value="@Model.Cdtptabela" readonly />
    </div>
    <div class="col-md-9">
      <label asp-for="Dctabela" class="form-label"></label>
      <input asp-for="Dctabela" class="form-control" maxlength="60" />
      <span asp-validation-for="Dctabela" class="text-danger"></span>
    </div>
  </div>

  <div class="mt-4 d-flex justify-content-end gap-2">
    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
    <button type="submit" class="btn btn-primary">Salvar</button>
  </div>
</form>

<script>
  (function(){
    const $form = $('#formEdit');
    $form.on('submit', async function(e){
      e.preventDefault();
      const token = document.querySelector('meta[name="request-verification-token"]')?.content;
      const formData = $form.serialize();
      const resp = await fetch($form.attr('action'), {
        method: 'POST',
        headers: { 'RequestVerificationToken': token, 'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8' },
        body: formData
      });
      const json = await resp.json();
      if(json?.success){
        $('#formModal').modal('hide');
        $('#gridTaux1').DataTable().ajax.reload(null, false);
      }else{
        alert(json?.message || 'Falha ao salvar.');
      }
    });

    $form.find('[name="Dctabela"]').each(function(){
      $(this).rules && $(this).rules('add', {
        required: true,
        normalizer: function(v){ return (v||'').trim(); }
      });
    });
  })();
</script>
