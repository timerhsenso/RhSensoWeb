# Especifica√ß√£o T√©cnica Completa: Front-End Gen√©rico para Grid Din√¢mica

## üìã Vis√£o Geral do Projeto

**T√≠tulo**: Implementa√ß√£o de Front-End Gen√©rico para Grid com DataTables  
**Objetivo**: Desenvolver uma interface de usu√°rio (UI) de listagem altamente reutiliz√°vel e configur√°vel atrav√©s de JSON. O sistema deve consistir em componentes √∫nicos capazes de gerenciar qualquer entidade (Sistemas, Usu√°rios, Perfis) apenas alterando um objeto de configura√ß√£o.

**Compatibilidade**: 100% compat√≠vel com TsistemaController, priorizando endpoints AJAX (retorno JSON) sobre formul√°rios tradicionais com redirecionamento.

---

## üõ†Ô∏è Stack Tecnol√≥gica

- **Framework**: ASP.NET Core MVC (.NET 8)
- **JavaScript**: jQuery 3.7+, DataTables 2.x (extens√µes: Buttons, Responsive, ColReorder)
- **UI Framework**: Bootstrap 5
- **√çcones**: Font Awesome 6
- **Valida√ß√£o**: jQuery Validation Plugin

---

## üèóÔ∏è Arquitetura e Princ√≠pios Fundamentais

### 1. **Configura√ß√£o Centralizada via JSON**
- Toda l√≥gica da grid controlada por objeto JSON em `<script id="grid-config" type="application/json">`
- Zero JavaScript espec√≠fico por entidade
- Configura√ß√£o declarativa completa

### 2. **Seguran√ßa Integrada**
- Token CSRF obrigat√≥rio em todas requisi√ß√µes POST via header `X-CSRF-TOKEN`
- Leitura autom√°tica de `<meta name="RequestVerificationToken">`
- Valida√ß√£o server-side e client-side

### 3. **Componentiza√ß√£o Modular**
- **Topbar**: T√≠tulo, busca global, a√ß√µes em massa
- **Grid**: DataTables configur√°vel
- **Modais**: Reutiliz√°veis para formul√°rios e confirma√ß√µes
- **Feedback**: Loading states e notifica√ß√µes toast

### 4. **Experi√™ncia do Usu√°rio (UX)**
- Feedback visual para todas opera√ß√µes
- Estados de carregamento durante AJAX
- Notifica√ß√µes de sucesso/erro
- Interface responsiva
- Acessibilidade (ARIA labels)

---

## üîÑ Mapeamento Completo de Funcionalidades

| Funcionalidade | Endpoint | M√©todo | Implementa√ß√£o |
|---|---|---|---|
| **Carregamento Inicial** | `GetData` | GET | DataTable inicializada via AJAX, mapeando `response.data` |
| **Novo Registro** | `Create` | GET/POST | Bot√£o "Novo" ‚Üí Modal (se `useModal: true`) ou navega√ß√£o |
| **Edi√ß√£o** | `Edit/{id}` | GET/POST | Bot√£o "Editar" ‚Üí Modal com dados pr√©-carregados |
| **Exclus√£o Segura** | `DeleteByToken` | POST | Modal de confirma√ß√£o ‚Üí POST com token |
| **Exclus√£o em Massa** | `DeleteBatch` | POST | Checkbox sele√ß√£o ‚Üí Confirma√ß√£o ‚Üí POST array IDs |
| **Toggle Status** | `UpdateAtivo` | POST | Switch interativo ‚Üí POST estado (true/false) |
| **Exporta√ß√£o** | - | - | Bot√µes DataTables (Excel, PDF, Print, ColVis) |

---

## üìù Estrutura de Configura√ß√£o JSON Completa

```json
{
  "title": "Sistemas",
  "subTitle": "Configura√ß√µes Globais do Sistema",
  "useModal": true,
  
  "routes": {
    "list": "/SEG/Tsistema/GetData",
    "createGet": "/SEG/Tsistema/Create",
    "createPost": "/SEG/Tsistema/Create",
    "editGet": "/SEG/Tsistema/Edit/{id}",
    "editPost": "/SEG/Tsistema/Edit/{id}",
    "deletePost": "/SEG/Tsistema/DeleteByToken",
    "deleteBatchPost": "/SEG/Tsistema/DeleteBatch",
    "updateAtivoPost": "/SEG/Tsistema/UpdateAtivo"
  },
  
  "columns": [
    { 
      "type": "checkbox", 
      "width": "30px",
      "className": "text-center"
    },
    { 
      "data": "cdsistema", 
      "title": "C√≥digo", 
      "width": "100px",
      "searchable": true,
      "orderable": true
    },
    { 
      "data": "dcsistema", 
      "title": "Descri√ß√£o",
      "searchable": true,
      "orderable": true
    },
    { 
      "data": "ativo", 
      "title": "Status", 
      "width": "80px", 
      "render": { 
        "type": "booleanToggle",
        "trueText": "Ativo",
        "falseText": "Inativo"
      },
      "className": "text-center"
    },
    {
      "type": "actions",
      "title": "A√ß√µes",
      "width": "120px",
      "orderable": false,
      "searchable": false,
      "className": "text-center",
      "buttons": [
        { 
          "type": "edit", 
          "icon": "fa-solid fa-pencil", 
          "tooltip": "Editar registro",
          "class": "btn btn-sm btn-outline-primary"
        },
        { 
          "type": "delete", 
          "icon": "fa-solid fa-trash", 
          "tooltip": "Excluir registro",
          "class": "btn btn-sm btn-outline-danger"
        }
      ]
    }
  ],
  
  "settings": {
    "rowId": "cdsistema",
    "deleteTokenField": "token",
    "language": "pt-BR",
    "responsive": true,
    "autoWidth": false,
    "processing": true,
    "serverSide": false
  },
  
  "pagination": {
    "pageLength": 25,
    "lengthMenu": [[10, 25, 50, 100, -1], [10, 25, 50, 100, "Todos"]]
  },
  
  "search": {
    "placeholder": "Buscar em todos os campos...",
    "delay": 500,
    "minLength": 2
  },
  
  "export": {
    "excel": true,
    "pdf": true,
    "print": true,
    "colvis": true,
    "filename": "Sistemas"
  },
  
  "permissions": {
    "create": true,
    "edit": true,
    "delete": true,
    "deleteBatch": true,
    "export": true,
    "toggleStatus": true
  },
  
  "validation": {
    "clientSide": true,
    "showErrors": "inline",
    "rules": {
      "dcsistema": {
        "required": true,
        "minlength": 3,
        "maxlength": 100
      }
    },
    "messages": {
      "dcsistema": {
        "required": "Descri√ß√£o √© obrigat√≥ria",
        "minlength": "M√≠nimo 3 caracteres",
        "maxlength": "M√°ximo 100 caracteres"
      }
    }
  },
  
  "callbacks": {
    "beforeCreate": null,
    "afterCreate": "reloadGrid",
    "beforeEdit": null,
    "afterEdit": "reloadGrid",
    "beforeDelete": null,
    "afterDelete": "reloadGrid",
    "onToggleStatus": "showStatusToast"
  },
  
  "ui": {
    "theme": "bootstrap5",
    "fixedHeader": true,
    "fixedColumns": {
      "left": 1,
      "right": 1
    },
    "rowHeight": "auto",
    "stripeClasses": ["odd", "even"]
  },
  
  "messages": {
    "confirmDelete": "Tem certeza que deseja excluir este registro?",
    "confirmBatchDelete": "Tem certeza que deseja excluir os {count} registros selecionados?",
    "noSelection": "Selecione pelo menos um registro",
    "deleteSuccess": "Registro exclu√≠do com sucesso",
    "deleteError": "Erro ao excluir registro",
    "updateSuccess": "Registro atualizado com sucesso",
    "createSuccess": "Registro criado com sucesso"
  }
}
```

---

## üì¶ Entreg√°veis Detalhados

### 1. **Index.cshtml (View Gen√©rica)**
```html
@{
    ViewData["Title"] = "Grid Gen√©rica";
        Layout = "~/Views/Shared/_VerticalLayout.cshtml";
}

<!-- Estrutura do Card Principal -->
<div class="card">
    <div class="card-header" id="grid-topbar">
        <!-- T√≠tulo, subt√≠tulo e a√ß√µes ser√£o inseridos dinamicamente -->
    </div>
    <div class="card-body">
        <table id="grid" class="table table-striped table-hover w-100">
            <!-- Cabe√ßalho e dados inseridos pelo DataTables -->
        </table>
    </div>
</div>

<!-- Configura√ß√£o JSON -->
<script id="grid-config" type="application/json">
    @Html.Raw(ViewBag.GridConfig ?? "{}")
</script>

<!-- Inclus√£o dos Modais -->
@await Html.PartialAsync("_FormModal")
@await Html.PartialAsync("_ConfirmModal")

@section Styles {
    <link rel="stylesheet" href="~/css/crud.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/2.0.0/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/3.0.0/css/buttons.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/responsive/3.0.0/css/responsive.bootstrap5.min.css">
}

@section Scripts {
    <script src="https://cdn.datatables.net/2.0.0/js/dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/2.0.0/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/3.0.0/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/3.0.0/js/buttons.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/3.0.0/js/dataTables.responsive.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/3.0.0/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/3.0.0/js/buttons.print.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/3.0.0/js/buttons.colVis.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.5/jquery.validate.min.js"></script>
    <script src="~/js/app-grid.js"></script>
}
```

### 2. **app-grid.js (L√≥gica Principal)**
**Estrutura Modular Requerida**:

```javascript
/**
 * Grid Din√¢mica - Sistema Gen√©rico de CRUD
 * Vers√£o: 2.0
 * Compatibilidade: jQuery 3.7+, DataTables 2.x, Bootstrap 5
 */

class GridManager {
    constructor() {
        this.config = null;
        this.table = null;
        this.csrf = null;
    }
    
    // M√©todos principais a implementar:
    init()                    // Inicializa√ß√£o geral
    loadConfig()             // Carrega JSON de configura√ß√£o
    setupCSRF()              // Configura token CSRF
    buildTopbar()            // Constr√≥i barra superior
    initializeDataTable()    // Inicializa DataTables
    setupEventHandlers()     // Configura eventos
    renderColumns()          // Renderiza colunas dinamicamente
    handleBooleanToggle()    // Gerencia toggle de status
    showFormModal()          // Exibe modal de formul√°rio
    showConfirmModal()       // Exibe modal de confirma√ß√£o
    performAjaxAction()      // Executa a√ß√µes AJAX
    showNotification()       // Exibe notifica√ß√µes toast
    reloadGrid()            // Recarrega dados da grid
    validateForm()          // Valida formul√°rios
    executeCallback()       // Executa callbacks customizados
}

// Inicializa√ß√£o autom√°tica
$(document).ready(() => {
    window.gridManager = new GridManager();
    window.gridManager.init();
});
```

### 3. **_FormModal.cshtml (Modal de Formul√°rio)**
```html
<div class="modal fade" id="formModal" tabindex="-1" aria-labelledby="formModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="formModalLabel">Formul√°rio</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="formModalBody">
                <div class="d-flex justify-content-center">
                    <div class="spinner-border" role="status">
                        <span class="visually-hidden">Carregando...</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fa-solid fa-times me-1"></i>Cancelar
                </button>
                <button type="button" class="btn btn-primary" id="saveFormBtn">
                    <i class="fa-solid fa-save me-1"></i>Salvar
                </button>
            </div>
        </div>
    </div>
</div>
```

### 4. **_ConfirmModal.cshtml (Modal de Confirma√ß√£o)**
```html
<div class="modal fade" id="confirmModal" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmModalLabel">Confirma√ß√£o</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="d-flex align-items-center">
                    <i class="fa-solid fa-triangle-exclamation text-warning fs-1 me-3"></i>
                    <div>
                        <p class="mb-0" id="confirmMessage">Mensagem de confirma√ß√£o</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fa-solid fa-times me-1"></i>Cancelar
                </button>
                <button type="button" class="btn btn-danger" id="confirmActionBtn">
                    <i class="fa-solid fa-check me-1"></i>Confirmar
                </button>
            </div>
        </div>
    </div>
</div>
```

### 5. **crud.css (Estilos Complementares)**
```css
/* Estados de loading */
.dt-processing {
    position: absolute !important;
    top: 50% !important;
    left: 50% !important;
    transform: translate(-50%, -50%) !important;
}

/* Toggle de status */
.status-toggle {
    cursor: pointer;
    transition: all 0.2s ease;
}

.status-toggle:hover {
    transform: scale(1.1);
}

/* Bot√µes de a√ß√£o */
.action-buttons .btn {
    margin: 0 2px;
}

/* Responsividade mobile */
@media (max-width: 768px) {
    .card-header {
        padding: 0.75rem 0.5rem;
    }
    
    .btn-sm {
        padding: 0.25rem 0.4rem;
        font-size: 0.75rem;
    }
}

/* Melhorias de acessibilidade */
.visually-hidden-focusable:not(:focus):not(:focus-within) {
    position: absolute !important;
    width: 1px !important;
    height: 1px !important;
    padding: 0 !important;
    margin: -1px !important;
    overflow: hidden !important;
    clip: rect(0, 0, 0, 0) !important;
    white-space: nowrap !important;
    border: 0 !important;
}
```

---

## ‚úÖ Checklist de Implementa√ß√£o

### Funcionalidades Core
- [ ] Carregamento de configura√ß√£o JSON
- [ ] Inicializa√ß√£o da DataTable
- [ ] Renderiza√ß√£o din√¢mica de colunas
- [ ] Sistema de a√ß√µes (Create, Edit, Delete)
- [ ] Modais reutiliz√°veis
- [ ] Integra√ß√£o CSRF
- [ ] Feedback visual (loading/toasts)

### Funcionalidades Avan√ßadas
- [ ] Exclus√£o em massa
- [ ] Toggle de status interativo
- [ ] Valida√ß√£o client-side
- [ ] Exporta√ß√£o (Excel, PDF, Print)
- [ ] Busca global
- [ ] Pagina√ß√£o configur√°vel
- [ ] Responsividade
- [ ] Acessibilidade (ARIA)

### Testes e Valida√ß√£o
- [ ] Teste em diferentes entidades
- [ ] Valida√ß√£o de seguran√ßa (CSRF)
- [ ] Teste de responsividade
- [ ] Valida√ß√£o de acessibilidade
- [ ] Performance com grandes datasets

---

## üéØ Resultado Esperado

Um sistema de grid completamente gen√©rico onde:

1. **Desenvolvedores** podem criar novas telas apenas modificando o JSON de configura√ß√£o
2. **Usu√°rios** t√™m uma experi√™ncia consistente e intuitiva em todas as telas
3. **Sistema** mant√©m seguran√ßa, performance e acessibilidade
4. **Manuten√ß√£o** √© centralizada e simplificada

**Crit√©rio de Sucesso**: Qualquer desenvolvedor deve conseguir criar uma nova grid funcional em menos de 5 minutos, apenas copiando a View e ajustando o JSON de configura√ß√£o.